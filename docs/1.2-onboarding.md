Absolutely â€” hereâ€™s the **final refined product spec** for your Reef.Regen onboarding flow, including corrected copy, best-practice naming (`ProfileSetupStep` / `ProfileDetailsStep`), and improved accessibility-friendly markup for dev handoff:

---

# Reef.Regen â€” Onboarding Flow Spec

**Date:** 2025-10-31
**Owner:** Reef.Regen Product Team

---

## ğŸ§­ Overview

The onboarding flow is a **site-wide component** that ensures every signed-in user has a valid **organization name (`org_name`)** before interacting with the platform.
It prompts first-time users (or users missing an organization name) to set up their profile.

This is critical because the **organization name** is used as the **identifier in EAS attestations** for all reef restoration actions.

---

## ğŸ·ï¸ Terminology

- â€œProfile nameâ€ in earlier drafts = `org_name` in our database and APIs.
- We will use the term â€œorganization nameâ€ in UX copy and persist it as `org_name`.

---

## ğŸ§© Flow Summary

| Step | Component Name         | Purpose                                                                        |
| ---- | ---------------------- | ------------------------------------------------------------------------------ |
| 1    | **ProfileSetupStep**   | Collect and save the userâ€™s organization name (required)                       |
| 2    | **ProfileDetailsStep** | Optionally let user add a description and website to personalize their profile |

---

## ğŸ§  Logic

1. **On Sign In**

   * Check if `org_name` exists in the `profiles` table.
   * If empty â†’ trigger onboarding flow.
   * If present â†’ skip onboarding and continue to intended destination.

2. **Flow Enforcement**

   * Onboarding is **mandatory** until `org_name` is set.
   * `description` and `website` fields are optional.
   * Once completed, the user is considered onboarded (derived) if `org_name` is set.

3. **Entry Point Redirects**

   * If user signed in from **Submit** page â†’ return to Submit after onboarding.
   * If user signed in from **Home** â†’ return to Home.
   * Preserve entry path via router state or query param.

---

## ğŸ§¾ Data Requirements

| Field          | Type      | Required | Notes                                |
| -------------- | --------- | -------- | ------------------------------------ |
| `org_name`     | `text`    | âœ…        | Used in EAS attestations             |
| `description`  | `text`    | âŒ        | Optional text for public profile     |
| `website`      | `text`    | âŒ        | Optional link for public profile     |
| `is_onboarded` | `boolean` | Derived  | Considered `true` once `org_name` saved |

---

## ğŸ” Redirect Behavior

* Onboarding completion â†’ `router.replace(referrer || "/")`
* Store referrer path via `localStorage` or router query (`?redirect=/submit`)
* No separate redirect page â€” redirect triggers automatically on successful save

---

## ğŸ“± Responsiveness

* Desktop: content centered, `max-w-[600px]`
* Tablet/Mobile: full-width stacked layout
* Typography: Outfit font, Vulcan theme
* Maintain consistent padding (`px-6` mobile, `px-24` desktop)

---

## ğŸ§ª Edge Cases

* User refreshes mid-onboarding â†’ restore last step
* Existing profile name â†’ skip flow
* Invalid website format â†’ inline validation error
* Network error â†’ retry prompt

---

## âœ… Acceptance Criteria

* [ ] Users missing `org_name` always prompted
* [ ] Onboarding considered complete after `org_name` saved
* [ ] Fully responsive (desktop â†’ mobile)
* [ ] Redirect returns user to entry point
* [ ] Optional fields skippable
* [ ] Forms use semantic elements (`form`, `label`, `input`, `textarea`, `button`)

---

## ğŸ·ï¸ Naming Convention

Industry-standard, descriptive component naming improves clarity and scalability:

* `ProfileSetupStep` â†’ replaces â€œonboarding-1â€
* `ProfileDetailsStep` â†’ replaces â€œonboarding-2â€

This pattern follows multi-step UI conventions (e.g., `AccountSetupStep`, `PaymentDetailsStep`).

---

## ğŸ’» UI â€” ProfileSetupStep

```html
<form class="w-full max-w-screen-xl mx-auto px-6 lg:px-24 pt-16 pb-52">
  <div class="w-full max-w-[600px] mx-auto flex flex-col gap-6">
    <div class="flex flex-col gap-8">
      <div class="flex flex-col gap-4">
        <h1 class="text-White text-5xl md:text-7xl font-black leading-tight">Welcome to Reef.Regen</h1>
        <p class="text-Vulcan-400 text-xl md:text-2xl font-light leading-9">
          We want to ensure your organization name is written correctly on the blockchain.
          Please enter the organization you represent (or your personal name).
        </p>
      </div>

      <div class="flex flex-col gap-2">
        <label for="org_name" class="text-Vulcan-500 text-lg font-bold leading-6">
          Organization name <span class="font-normal">(used on blockchain attestations)</span>
        </label>
        <input id="org_name" name="org_name" required
               class="w-full p-4 bg-Vulcan-700 rounded-lg text-White placeholder-Vulcan-400 text-2xl font-light leading-9
                      focus:outline-none focus:ring-2 focus:ring-Orange"
               placeholder="Enter name here" />
      </div>
    </div>

    <div class="flex gap-6">
      <button type="submit"
              class="flex-1 px-6 py-2 bg-Orange rounded-2xl text-White text-xl font-bold leading-8">
        Next
      </button>
    </div>
  </div>
</form>
```

---

## ğŸ’» UI â€” ProfileDetailsStep

```html
<form class="w-full max-w-screen-xl mx-auto px-6 lg:px-24 pt-16 pb-52">
  <div class="w-full max-w-[600px] mx-auto flex flex-col gap-6">
    <div class="flex flex-col gap-8">
      <div class="flex flex-col gap-4">
        <h1 class="text-White text-5xl md:text-7xl font-black leading-tight">Complete your profile</h1>
        <p class="text-Vulcan-400 text-xl md:text-2xl font-light leading-9">
          Each user on Reef.Regen has a public-facing profile to showcase their regeneration actions.
          Add a description and link youâ€™d like to share with the public.
        </p>
      </div>

      <div class="flex flex-col gap-2">
        <label for="description" class="text-Vulcan-500 text-lg font-bold leading-6">Description</label>
        <textarea id="description" name="description" rows="6"
                  class="w-full p-4 bg-Vulcan-700 rounded-lg text-White placeholder-Vulcan-400 text-2xl font-light leading-9
                         focus:outline-none focus:ring-2 focus:ring-Orange"
                  placeholder="Tell us about your organizationâ€™s work..."></textarea>
      </div>

      <div class="flex flex-col gap-2">
        <label for="website" class="text-Vulcan-500 text-lg font-bold leading-6">Website</label>
        <input id="website" name="website" type="url"
               class="w-full p-4 bg-Vulcan-700 rounded-lg text-White placeholder-Vulcan-400 text-2xl font-light leading-9
                      focus:outline-none focus:ring-2 focus:ring-Orange"
               placeholder="https://www.example.com" />
      </div>
    </div>

    <div class="flex gap-6">
      <button type="button"
              class="flex-1 px-6 py-2 rounded-2xl border-2 border-Vulcan-500 text-White text-xl font-bold leading-8">
        Do it later
      </button>
      <button type="submit"
              class="flex-1 px-6 py-2 bg-Orange rounded-2xl text-White text-xl font-bold leading-8">
        Save & Continue
      </button>
    </div>
  </div>
</form>
```

---

## âš™ï¸ Developer Implementation Notes

**Redirect logic:**

```ts
const redirectTo = router.query.redirect || router.state?.redirectTo || '/';

async function handleSetup(values, walletAddress) {
  await fetch('/api/profiles/upsert', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ wallet_address: walletAddress, org_name: values.name })
  });
  router.replace({ pathname: '/profile/details', query: { redirect: redirectTo } });
}

async function handleDetails(values, walletAddress) {
  await fetch('/api/profiles/upsert', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ wallet_address: walletAddress, description: values.desc, website: values.url })
  });
  router.replace(redirectTo);
}
```

**Guard Hook:** `useOnboardingGate()`

* Triggered on every sign-in
* Redirects to `/profile/setup` if no `org_name`

---

## ğŸ“Š Analytics Events

| Event                       | Parameters                         | Description               |             |
| --------------------------- | ---------------------------------- | ------------------------- | ----------- |
| `onboarding_view`           | `{ step: 'setup'                   | 'details' }`              | Viewed step |
| `onboarding_set_org_name`   | `{ length }`                       | User entered organization name |
| `onboarding_saved_optional` | `{ has_description, has_website }` | Optional fields saved     |
| `onboarding_skip_optional`  | â€“                                  | Skipped optional fields   |
| `onboarding_complete`       | `{ redirectTo }`                   | Completed onboarding      |

---

## ğŸ§© QA Checklist

* [ ] Guard triggers from all sign-in points
* [ ] Redirect param respected end-to-end
* [ ] Form validation errors shown inline
* [ ] Keyboard navigation & focus states tested
* [ ] Mobile viewport verified at 375 Ã— 812 and 320 Ã— 640
* [ ] `router.replace()` prevents back-stack loop

---

âœ… **Summary:**
This final spec defines a responsive, two-step onboarding process using `ProfileSetupStep` and `ProfileDetailsStep` components, adhering to best UI patterns, semantic markup, and accessibility standards. The flow auto-redirects after completion and integrates cleanly into existing EAS-based profile logic.

---

Would you like me to also generate a short **developer checklist** (tasks + estimated hours) from this spec? It would help your dev team move into implementation phase quickly.
