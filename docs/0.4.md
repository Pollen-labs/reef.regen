# v0.4 — Embedded Wallet POC (MetaMask Embedded / Web3Auth)

Summary
- Embedded-only wallet flow using MetaMask Embedded Wallets (formerly Web3Auth) with the official React SDK.
- Users sign delegated EAS messages in-browser; a relayer posts them on-chain.
- Automatic preflight checks and best-effort chain switching to OP Sepolia.

What’s included
- Web3Auth React provider + Wagmi bridge for a seamless dapp experience.
- Single “Connect Embedded Wallet” entry point (no extension flow).
- Attestation signing requires the embedded wallet; MetaMask extension is not used.

Connect & Chain Handling
- On connect: users log in (e.g., Google) via the embedded wallet modal.
- On submit: preflight verifies chain and contract before signing.
  - If not on OP Sepolia (11155420), we try `wallet_switchEthereumChain` to `0xAA37DC`.
  - If the chain isn’t added, we try `wallet_addEthereumChain` then switch.
  - We re-instantiate the provider and signer after switching to avoid “network changed” errors.
  - If switching still fails, we surface a clear wrong-network error.

Signing & Relaying
- The app encodes EAS payload bytes for your schema, then signs an EIP-712 delegated attestation with the embedded wallet.
- It POSTs to the relayer (`RELAYER_URL`) which verifies and calls EAS on-chain, returning the attestation `uid` (and/or `txHash`).

Environment
- `NEXT_PUBLIC_CHAIN_ID=11155420` (OP Sepolia)
- `NEXT_PUBLIC_EAS_ADDRESS` set to OP Sepolia EAS address
- `NEXT_PUBLIC_DEFAULT_SCHEMA_UID` set to your schema UID
- `NEXT_PUBLIC_EAS_VERSION` should match your target EAS deployment (e.g., `0.26` or `1.0.0`)
- `NEXT_PUBLIC_WEB3AUTH_CLIENT_ID` — your project’s Client ID
- `NEXT_PUBLIC_WEB3AUTH_NETWORK` — `sapphire_devnet` or `sapphire_mainnet` to match the Client ID’s environment

UI Changes in v0.4
- WalletConnect shows only “Connect Embedded Wallet”.
- AttestationForm signs strictly with the embedded wallet provider.
- Nav “Logout” logs out embedded wallet and wagmi.
- “Connect” page copy updated to reflect embedded-only flow.

Troubleshooting
- Wrong network: Debug panel shows connected/expected chainIds and attempts to switch. If your dashboard doesn’t allow OP Sepolia, enable it.
- No contract code: Check `NEXT_PUBLIC_EAS_ADDRESS` and target chain.
- Modal not opening: Verify Client ID, origin whitelisting, and network (`NEXT_PUBLIC_WEB3AUTH_NETWORK`).

Notes
- The flow is chain-agnostic in configuration, but the app currently targets OP Sepolia and switches at submit time for reliability.

