# Reef.Regen â€” Account / Dashboard Specification

**Modes:**

* **My Account View:** visible when the logged-in user is viewing their own profile (`/account`)
* **Public Profile View:** visible when any visitor views another userâ€™s account (`/account/[id]`)

---

## ğŸ§­ Overview

The **Account page** provides a clear overview of a profileâ€™s reef restoration contributions, biodiversity impact, and attestation activity.
It acts both as a *dashboard* for authenticated users and a *public portfolio page* for external viewers.

---

## ğŸ§© Page Structure

| Section                              | Purpose                                                                                       |
| ------------------------------------ | --------------------------------------------------------------------------------------------- |
| **Header**                           | Profile summary (org name, description, website, wallet address)                              |
| **Stat Summary**                     | Aggregate counts: Regen Actions, Sites, Species, Attestations                                 |
| **Charts Section**                   | 1. Donut chart of action types<br>2. Site-type donut chart<br>3. Static map of site locations |
| **Embed Snippet (own account only)** | Provide an iframe snippet for external embedding                                              |
| **Biodiversity Section**             | All taxa used in attestations, displayed as chips                                             |
| **Attestations Table**               | List of attestations with modal for detail view                                               |

---

## ğŸ§± 1. Profile Header

| Field                 | Description                        | Source                    |
| --------------------- | ---------------------------------- | ------------------------- |
| **Organization name** | The profileâ€™s `profile_name`       | `profiles.profile_name`   |
| **Description**       | Optional paragraph from onboarding | `profiles.description`    |
| **Website**           | External link, optional            | `profiles.website`        |
| **Wallet address**    | Show as truncated: `0x1234...ABCD` | `profiles.wallet_address` |

### Layout

* Left column, large heading for org name (e.g., `text-5xl font-black text-orange-400`).
* Paragraph text for description (medium-gray tone).
* Link underlined for website.
* Wallet displayed in small monospace font.

---

## ğŸ“Š 2. Summary Stats

Display four cards horizontally (responsive stack on mobile):

| Stat              | Data Source                                                                         | Example |
| ----------------- | ----------------------------------------------------------------------------------- | ------- |
| **Regen actions** | Count of distinct `reef_regen_actions` used across all attestations by this profile | `4`     |
| **Sites**         | Count of distinct `site_id`                                                         | `2`     |
| **Species**       | Count of distinct taxa (`taxon_id`)                                                 | `8`     |
| **Attestations**  | Total number of attestations                                                        | `12`    |

Each card:

* Rounded, padded, centered number + label.
* Color: lighter background, large bold number, small label text.

---

## ğŸ“ˆ 3. Chart Section

Two fixed-height chart containers stacked vertically (right side on desktop).

### 3.1 Regen Actions Donut Chart

* Chart: **Recharts / DonutChart**
* Labels: all possible action names (static list from `regen_type` table).
* Data: frequency count per action name from all attestations.
* Center label: total count.
* Color palette: pastel coral blues/oranges.

```js
[
  { name: "Microfragmentation", value: 3 },
  { name: "Nursery", value: 1 },
  { name: "Transplantation Phase", value: 0 },
  ...
]
```

---

### 3.2 Site Type Donut Chart

* Chart: second donut with smaller size.
* Data: aggregated count per site type (`Nursery`, `Outplant reef`, etc.).
* Goal: give public a quick sense of site diversity.

```js
[
  { name: "Outplant reef", value: 2 },
  { name: "Nursery", value: 1 }
]
```

---

### 3.3 Static Map of Sites

* Fixed height (matches donut section).
* **Map library:** MapLibre (read-only mode)
* Render all sites belonging to this profile as markers.
* No clustering; each site clickable.
* Hover shows tooltip: site name + type.
* Zoom & pan disabled for public; optional for owner.

**Dataset:**

```json
[
  { "name": "East side coral", "type": "Nursery", "coords": [99.841, 10.112] },
  { "name": "West reef", "type": "Outplant reef", "coords": [100.112, 9.981] }
]
```

---

## ğŸª¶ 4. Embed Snippet (only visible on **My Account View**)

Provide a small collapsible panel titled:

> â€œEmbed this map data onto your siteâ€

### UI

* Text: â€œEmbed your public reef regeneration summary into your organizationâ€™s website.â€
* Button: **Show code**
* Expand reveals textarea with iframe snippet:

```html
<iframe
  src="https://reef.regen.app/embed/account?org=coral-guardians"
  width="100%"
  height="600"
  frameborder="0"
  allowfullscreen
></iframe>
```

### Behavior

* Copy-to-clipboard button.
* If user regenerates link (future option), update embed URL.
* **Link behavior:** clicking a site dot in embedded map opens the main Reef.Regen map page with that location active (`/map?site=<id>`).

---

## ğŸª¸ 5. Biodiversity Section

Title: **Biodiversity**
Display all taxa this profile has recorded across all attestations.

* Use chip components from Step 4 (`TagChip` style).
* Each chip: species scientific name.
* Sort alphabetically, deduplicate.
* Optionally show total count above: â€œ8 species recordedâ€.

Example:

```
[ Acanthella arbuscula ] [ Heterogorgia tortuosa ] [ Sinularia dura ] ...
```

---

## ğŸ“„ 6. Attestations Table

### Layout

* Title: â€œAttestationsâ€
* Table with columns:

| Column            | Description                                       |
| ----------------- | ------------------------------------------------- |
| **Attest date**   | Action date (primary start date from attestation) |
| **Regen actions** | Comma-separated names                             |
| **Site name**     | From site record                                  |
| **View**          | Ellipsis button to open modal                     |

### Behavior

* Clicking a row or ellipsis opens the **Attestation Detail Modal**, a shared component used elsewhere (same modal used on map clicks).
* Modal shows:

  * Date, actions, site, summary, contributors, file link, and EAS UID.
* Table pagination optional; default sort: most recent first.

---

## ğŸ” 7. Ownership Mode Logic

| Feature                  | My Account View   | Public View        |
| ------------------------ | ----------------- | ------------------ |
| Edit profile (gear icon) | âœ… visible         | âŒ hidden           |
| Embed iframe code        | âœ… visible         | âŒ hidden           |
| Map interaction          | Zoom/pan enabled  | Read-only          |
| Attestation detail modal | âœ… visible         | âœ… visible          |
| API data source          | `/api/account/me` | `/api/account/:id` |

### Owner toolbar (top-right gear icon)

* Opens profile settings modal:

  * Edit description
  * Update website
  * (Later) Upload avatar/logo

---

## ğŸ§® 8. Data Aggregation (Backend)

When fetching account data (`GET /api/account/:id`):

```json
{
  "profile": {
    "id": "...",
    "profile_name": "Coral Guardians Initiative",
    "description": "...",
    "website": "https://www.com",
    "wallet_address": "0x1234...12345"
  },
  "stats": {
    "actions_total": 4,
    "sites_total": 2,
    "species_total": 8,
    "attestations_total": 12
  },
  "actions_breakdown": [
    { "name": "Microfragmentation", "count": 3 },
    { "name": "Nursery", "count": 1 }
  ],
  "site_types_breakdown": [
    { "name": "Outplant reef", "count": 2 },
    { "name": "Nursery", "count": 1 }
  ],
  "sites": [
    { "id": "s1", "name": "East side coral", "type": "Nursery", "coords": [99.841, 10.112] },
    { "id": "s2", "name": "West reef", "type": "Outplant reef", "coords": [100.112, 9.981] }
  ],
  "species": [
    "Acanella arbuscula",
    "Heterogorgia tortuosa",
    "Sinularia dura"
  ],
  "attestations": [
    {
      "id": "a1",
      "date": "2025-10-30",
      "actions": ["Microfragmentation", "Nursery"],
      "site": "East side coral"
    }
  ]
}
```

---

## ğŸ§  9. API endpoints

| Endpoint                     | Purpose                         |
| ---------------------------- | ------------------------------- |
| `GET /api/account/me`        | Logged-in user dashboard        |
| `GET /api/account/:id`       | Public view for another profile |
| `GET /api/account/:id/embed` | Data feed for iframe embed      |
| `GET /api/attestation/:id`   | Fetch detail for modal          |

---

## âœ… QA Checklist

* [ ] Page loads with correct profile metadata.
* [ ] Stats numbers update as attestations are created.
* [ ] Charts render correct proportions.
* [ ] Static map displays all site markers.
* [ ] Embed code only shown on own profile.
* [ ] Clicking table row opens attestation modal.
* [ ] Gear icon opens editable profile modal (own account only).

---

## ğŸŒ Example Layout Hierarchy

```
AccountPage
â”œâ”€ ProfileHeader
â”œâ”€ StatsGrid
â”œâ”€ ChartSection
â”‚  â”œâ”€ RegenActionDonut
â”‚  â”œâ”€ SiteTypeDonut
â”‚  â””â”€ StaticSiteMap
â”œâ”€ EmbedPanel (visible only if owner)
â”œâ”€ BiodiversitySection
â””â”€ AttestationTable
```

---

### âœ¨ Notes for implementation

* Reuse `DonutChart` component (already used in dashboard).
* Static Map uses same MapLibre config as main map (dark theme), no interaction.
* Embed iframe endpoint can render a simplified public view (just chart + map).
* Use `swr` or `react-query` to fetch account data for reactive updates.

---
