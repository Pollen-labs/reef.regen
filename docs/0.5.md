# v0.5 — Capture Web3Auth Email (Simple Version)

## Summary

* Minimal update to store the user's email in Supabase after logging in with Web3Auth (embedded wallet).
* No token verification or Edge Function required for this step.
* We reuse the existing Next.js API route (`POST /api/profiles/upsert`) to persist email server‑side (no client Supabase needed).

---

## Flow

### 1. Client

After a successful Web3Auth login, the app calls our server route to upsert the email:

```ts
// Inside WalletConnect once connected
if (userInfo?.email && address) {
  await fetch("/api/profiles/upsert", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ wallet_address: address, email: userInfo.email })
  });
}
```

---

## Database Update

Add an `email` column if not already present on `public.profiles`:

```sql
alter table public.profiles
add column if not exists email text;
```

---

## Expected UX

* User logs in via Web3Auth (Google, Apple, LinkedIn).
* App immediately saves their email in the `profiles` table along with their wallet address.
* No verification, backend, or JWT validation needed.

---

## Notes

* Simplest possible setup for testing or early versions.
* Email comes from Web3Auth SDK (`getUserInfo()` via `useWeb3AuthUser`).
* Can later expand to a verified JWT → Edge Function model if you want stronger trust.

---

## Completion Summary

- Implemented embedded‑only login with MetaMask Embedded (Web3Auth) and captured `userInfo.email` after connect.
- Client posts `{ wallet_address, email }` to `POST /api/profiles/upsert` once per session; errors do not block UX.
- Server route updated to accept optional `email` for both insert and update paths.
- Database migration added: `supabase/sql/005_v0_5.sql` (adds `email` to `public.profiles`).
- Verified end‑to‑end: after login, the profile row stores `email` alongside `wallet_address` without affecting existing attest/relay flows.
