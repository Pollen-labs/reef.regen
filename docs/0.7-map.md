# 0.7 ‚Äì Map Sprint: Global Navigation + Map Experience

> **Scope**: Ship the global navigation (TopNav + Footer) and the full-screen **Map** page with **Location Pane** and **Attestation Detail Modal**. Remove non-map/landing items from this sprint.

---

## Routes

* **/map** ‚Äî primary entry for MVP.
* **/** ‚Äî optional redirect to `/map`.

---

## Layout

* **AppShell** ‚Äî sticky TopNav, content area, Footer.

  * Slots: `topNav`, `content`, `footer`
  * Container: map page uses full-bleed; other pages (future) can use `max-w-7xl`.
  * Z‚Äëlayers: Map (z0), Location Pane (z10), Attestation Modal (z20), Toasts (z30).

---

## Global Navigation (P0)

* **TopNav**

  * Elements: logo, primary links (`Map`, `Submit`, `Github`), **AuthButton** (Sign in / user menu).
  * Props: `links: {label:string, href:string}[]`, `onSubmit?()`, `user?: {name?:string; address?:string}`, `onSignIn()`, `onSignOut()`
  * Behavior: sticky, dark theme; mobile hamburger ‚Üí Sheet.
* **Footer**

  * Blocks: logo + blurb, secondary links (`Map`, `Submit`, `Github`).
  * Props: `links: {label:string, href:string}[]`.

---

## Map Page Components (P0)

1. **MapView**

   * Full-screen canvas under TopNav, resizes with viewport.
   * Props: `points: LocationPoint[]`, `activeId?: string`, `onSelect(id)`, `onDeselect()`
   * Interactions: click pin ‚Üí `onSelect`; ESC ‚Üí deselect; optional URL sync.
   * Style: dark map; pins in `flamingo.400`; selected pin highlighted.

2. **MapMarker**

   * Variants: `default`, `highlighted` (selected), `cluster` (defer if needed).
   * a11y: `aria-label` with location + counts.

3. **LocationPane** (left drawer)

   * Trigger: select a map point; appears over map.
   * Props: `location: Location | null`, `onClose()`
   * Sections:

     * Header: org/location name (hd‚Äë4), coordinates.
     * **Stats** card: Regen actions donut + legend.
     * **Species**: pills list.
     * **AttestationList**: rows ‚Üí open modal.
   * Mobile: full-height sheet.

4. **AttestationItem** (row in pane)

   * Content: date, overflow actions; click ‚Üí open modal.

5. **AttestationDetailModal** (centered)

   * Props: `attestation: Attestation | null`, `onClose()`
   * Blocks: tags (action types), action date, summary, fields (coral count, depth), species chips, contributors, evidence file (gateway URL), EAS UID link.
   * a11y: focus trap, ESC to close, backdrop clickable.

6. **Feedback** (shared)

   * **Toast**, **Skeleton**, **EmptyState**, **ErrorState** for Map, Pane, Modal.

---

## Client-side Type Contracts

These are **TypeScript shapes we agree to use at the UI boundary**. They let us build/stub components now and swap in real data later without changing component code.

```ts
export type LocationPoint = {
  id: string;               // location_id
  name: string;             // org/location display
  lat: number;
  lng: number;
  attestationCount: number; // for marker badge (optional)
};

export type Location = LocationPoint & {
  actionsBreakdown: { label: string; count: number; color: string }[]; // donut
  species: string[];   // names
  attestations: Pick<Attestation, "id" | "title" | "submittedAt">[];
};

export type Attestation = {
  id: string;
  title?: string;
  submittedAt: string;  // ISO
  actionDate?: string;  // ISO
  actionTypes: string[];
  summary?: string;
  coralCount?: number;
  depth?: string;       // e.g., "5 meter"
  species: string[];
  contributors?: string[];
  fileName?: string;
  fileUrl?: string;     // IPFS gateway URL
  easUid?: string;      // on-chain UID
  locationId: string;
};
```

> **Why "contracts"?** Because both the UI and the data layer ‚Äúsign‚Äù this agreement. Mock data adheres to these types today; APIs should return data that matches them tomorrow. This keeps components stable and reduces refactors.

---

## URL State (nice to have P1)

* `?loc=<id>` ‚Äî opens LocationPane.
* `?att=<id>` ‚Äî opens AttestationDetailModal (implies `loc`).
* Persist map viewport in `#@lat,lng,zoom`.

---

## Acceptance Criteria

* Sticky TopNav and Footer render on `/map`.
* Map fills viewport beneath TopNav; Footer visible when panes/modals are closed.
* Clicking a pin opens LocationPane with mock data.
* Clicking an attestation opens AttestationDetailModal with full layout.
* ESC/backdrop closes pane/modal; mobile sheets behave correctly.
* a11y: focus states, focus trap in modal, keyboard close, links have discernible labels.

---

## Build Order (P0)

1. AppShell + TopNav + Footer
2. MapView + MapMarker (viewport sizing + pin select)
3. LocationPane shell + sections (static)
4. AttestationItem + AttestationDetailModal (static)
5. Wire mocks via the **type contracts**; open/close flows; optional URL params
6. Skeleton/Empty/Error + Toasts

---

## Checklist

* [x] TopNav implemented (desktop + mobile)
* [x] Footer implemented
* [x] MapView full-bleed + responsive
* [x] Marker select/deselect
* [x] LocationPane wired to backend (v0.4)
* [x] Attestation modal with focus trap + scroll + EAS UID
* [x] Skeleton/Empty/Error/Toast
* [x] Basic a11y pass


-----

> **Note:** Although the Figma design references fixed dimensions, this app will be built **responsive‚Äëfirst** using Tailwind's responsive utilities (`sm:`, `md:`, `lg:`) and fluid units (e.g. `max-w`, `flex`, `grid`, `aspect-video`). Each component here should gracefully adapt to small screens (mobile drawers, stacked layouts) and large viewports.

Below are paste‚Äëin skeletons aligned to **0.6/0.7 tokens** (Outfit, tracking, colors) and the **Map Sprint**. Replace mock data as you wire APIs.

---

## Data Wiring (v0.4 backend)

Endpoints and queries used by the Map page:

- Map pins ‚Üí `/api/attestations/public`
  - Backed by view `public.site_points_v` (one row per site with `attestation_count` for `show_on_map = true`).
  - Frontend maps each feature to `LocationPoint` (id/site_id, name, lat/lng, count).

- Location Pane ‚Üí `/api/sites/:id`
  - Calls RPC `public.get_site_detail(site_uuid, recent_count)` and returns a JSON shaped as `Location` with:
    `orgName`, `siteType`, `depthM`, `surfaceAreaM2`, `actionsBreakdown` (with colors), `species`, `attestations`.

- Attestation Detail Modal ‚Üí `/api/attestations/:id`
  - Aggregates from `public.attestation`, `public.attestation_min_v`, `public.site`/`public.site_type`, `public.profiles`, and `public.attestation_taxa`.
  - Returns: `actionTypes`, `summary`, `speciesWithCount`, `totalCorals`, `speciesDiversity`, `orgName`, `siteName`, `lat/lng`, `depthM`, `surfaceAreaM2`, `contributors`, `fileUrl`, `easUid`.

Views added for Map:

- `public.site_points_v` ‚Äî pins source (RLS enforced via base tables).
- `public.attestation_min_v` ‚Äî mini per‚Äëattestation aggregate used by RPC and detail API.

Shared components:

- `components/shared/DonutChart` ‚Äî shared donut chart used in Location Pane and profile.
- `components/shared/AttestationDetailModal` ‚Äî modal with max‚Äëheight + scroll and EAS UID card.

## `/types/map.ts`

```ts
export type LocationPoint = {
  id: string;
  name: string;
  lat: number;
  lng: number;
  attestationCount: number;
};

export type Location = LocationPoint & {
  actionsBreakdown: { label: string; count: number; color: string }[];
  species: string[];
  attestations: Pick<Attestation, "id" | "title" | "submittedAt">[];
};

export type Attestation = {
  id: string;
  title?: string;
  submittedAt: string;
  actionDate?: string;
  actionTypes: string[];
  summary?: string;
  coralCount?: number;
  depth?: string;
  species: string[];
  contributors?: string[];
  fileName?: string;
  fileUrl?: string;
  easUid?: string;
  locationId: string;
};
```

---

## `components/AppShell.tsx`

```tsx
import TopNav from "./TopNav";
import Footer from "./Footer";

export default function AppShell({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-dvh flex flex-col bg-white text-vulcan-900">
      <TopNav />
      <main className="relative flex-1">{children}</main>
      <Footer />
    </div>
  );
}
```

---

## `components/TopNav.tsx`

````tsx
"use client";
import { useState } from "react";

/**
 * TopNav translated from Figma Dev Mode snippet.
 * - Spacing: px-8 py-6, items-end
 * - Dark bar (black token), white text
 * - Links: Map, Submit
 * - CTA: Sign in (outline: 4px, offset -4, orange)
 */
export default function TopNav() {
  const [open, setOpen] = useState(false);
  return (
    <header className="sticky top-0 z-40 bg-black text-white">
      <div className="px-8 py-6 flex justify-between items-end">
        {/* Left: Logo + Wordmark (replace with real SVGs) */}
        <a href="/map" className="flex items-center gap-1">
          {/* Coral mark placeholder */}
          <div className="relative h-16 w-14">
            <div className="absolute inset-0 bg-white rounded" aria-hidden />
            <div className="absolute left-[1.69px] top-[1.69px] right-0 bottom-0 bg-orange rounded" aria-hidden />
            <div className="absolute left-[1.27px] top-[1.27px] right-0 bottom-0 bg-black rounded" aria-hidden />
            {/* dots (eyes) */}
            <div className="absolute left-[20.92px] top-[48.8px] h-1.5 w-1.5 bg-vulcan-50 rounded-full" />
            <div className="absolute left-[32.22px] top-[48.13px] h-1.5 w-1.5 bg-vulcan-50 rounded-full" />
          </div>
          {/* Wordmark placeholder block ‚Äì swap for SVG/image asset */}
          <div className="relative h-16 w-36">
            <div className="absolute top-0 left-0 h-8 w-7 bg-white" />
            <div className="absolute top-0 left-[27.24px] h-8 w-6 bg-white" />
            <div className="absolute top-0 left-[53.51px] h-8 w-6 bg-white" />
            <div className="absolute top-0 left-[79.78px] h-8 w-6 bg-white" />
            <div className="absolute top-[32.65px] left-0 h-8 w-7 bg-white" />
            <div className="absolute top-[32.65px] left-[27.24px] h-8 w-6 bg-white" />
            <div className="absolute top-[32.14px] left-[51.45px] h-8 w-8 bg-white" />
            <div className="absolute top-[32.65px] left-[86.11px] h-8 w-6 bg-white" />
            <div className="absolute top-[32.65px] left-[112.38px] h-8 w-7 bg-white" />
          </div>
          <span className="sr-only">Reef¬∑Regen</span>
        </a>

        {/* Right: Links + CTA (desktop) */}
        <nav className="hidden md:flex items-center gap-6">
          <a className="px-4 py-2 text-xl font-bold leading-8 hover:text-white/90" href="/map">Map</a>
          <a className="px-4 py-2 text-xl font-bold leading-8 hover:text-white/90" href="/submit">Submit</a>
          <button className="px-4 py-2 text-xl font-bold leading-8 rounded outline outline-4 outline-offset-[-4px] outline-orange hover:bg-white/5">
            Sign in
          </button>
        </nav>

        {/* Mobile trigger */}
        <button aria-label="Open menu" className="md:hidden inline-flex h-10 w-10 items-center justify-center rounded-lg hover:bg-white/5" onClick={() => setOpen(true)}>
          <span aria-hidden>‚ò∞</span>
        </button>
      </div>

      {/* Mobile Sheet */}
      {open && (
        <div className="md:hidden fixed inset-0 z-50 bg-black/50" role="dialog" aria-modal="true" onClick={() => setOpen(false)}>
          <div className="absolute left-0 top-0 h-full w-80 bg-black p-6 shadow-2xl" onClick={(e)=>e.stopPropagation()}>
            <button className="mb-6 rounded-lg px-3 py-2 hover:bg-white/5" onClick={() => setOpen(false)}>Close</button>
            <nav className="grid gap-2">
              <a href="/map" className="px-4 py-2 text-xl font-bold leading-8">Map</a>
              <a href="/submit" className="px-4 py-2 text-xl font-bold leading-8">Submit</a>
              <button className="mt-2 px-4 py-2 text-xl font-bold leading-8 rounded outline outline-4 outline-offset-[-4px] outline-orange">Sign in</button>
            </nav>
          </div>
        </div>
      )}
    </header>
  );
}
```tsx
"use client";
import { useState } from "react";

export default function TopNav() {
  const [open, setOpen] = useState(false);
  return (
    <header className="sticky top-0 z-40 bg-vulcan-900 text-white/90 backdrop-blur supports-[backdrop-filter]:bg-vulcan-900/95">
      <div className="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
        <a href="/map" className="flex items-center gap-2">
          {/* Replace with your SVG/Logo component */}
          <div className="h-8 w-8 rounded-xl bg-flamingo-400" aria-hidden />
          <span className="hd-6">Reef¬∑Regen</span>
        </a>

        <nav className="hidden md:flex items-center gap-6">
          <a className="font-semibold hover:text-white" href="/map">Map</a>
          <a className="hover:text-white" href="/submit">Submit</a>
          <a className="hover:text-white" href="https://github.com/">Github</a>
          <button className="ml-2 rounded-2xl border border-white/15 px-3 py-1.5 hover:bg-white/5">Sign in</button>
        </nav>

        <button aria-label="Open menu" className="md:hidden inline-flex h-10 w-10 items-center justify-center rounded-lg hover:bg-white/5" onClick={() => setOpen(true)}>
          <span className="i" aria-hidden>‚ò∞</span>
        </button>
      </div>

      {/* Mobile sheet */}
      {open && (
        <div className="md:hidden fixed inset-0 z-50 bg-black/50" role="dialog" aria-modal="true" onClick={() => setOpen(false)}>
          <div className="absolute left-0 top-0 h-full w-80 bg-vulcan-900 p-6 shadow-2xl" onClick={(e)=>e.stopPropagation()}>
            <button className="mb-6 rounded-lg px-3 py-2 hover:bg-white/5" onClick={() => setOpen(false)}>Close</button>
            <nav className="grid gap-4">
              <a href="/map" className="text-lg">Map</a>
              <a href="/submit" className="text-lg">Submit</a>
              <a href="https://github.com/" className="text-lg">Github</a>
              <button className="mt-4 rounded-2xl border border-white/15 px-3 py-2">Sign in</button>
            </nav>
          </div>
        </div>
      )}
    </header>
  );
}
````

---

## `components/Footer.tsx`

````tsx
/**
 * Footer translated from Figma Dev Mode snippet.
 * - Two main rows: top content bar + bottom decorative asset
 * - Colors: Vulcan‚Äë800 background, Vulcan‚Äë700 decorative blocks
 * - Layout: flex col, gap‚Äë8
 */
export default function Footer() {
  return (
    <footer className="bg-vulcan-800 flex flex-col gap-8">
      {/* Top bar */}
      <div className="w-full max-w-[1440px] mx-auto px-6 pt-10 flex justify-between items-end">
        <div className="flex items-end gap-1">
          {/* Logo placeholder */}
          <div className="relative h-32 w-28">
            <div className="absolute inset-0 bg-white" aria-hidden />
            <div className="absolute left-[3.4px] top-[3.41px] right-0 bottom-0 bg-orange" aria-hidden />
            <div className="absolute left-[2.55px] top-[2.55px] right-0 bottom-0 bg-black" aria-hidden />
            <div className="absolute left-[42.2px] top-[98.37px] h-3 w-3 bg-vulcan-50 rounded-full" />
            <div className="absolute left-[65.01px] top-[97.01px] h-3 w-3 bg-vulcan-50 rounded-full" />
          </div>
          <p className="max-w-[518px] text-base leading-6 font-light text-vulcan-200">
            Reef.Regen is a collaboration between <strong className="font-bold">Pollen Labs</strong> and <strong className="font-bold">MesoReef DAO</strong>.<br />
            Built for transparent, verifiable ocean restoration.
          </p>
        </div>

        <nav className="flex items-center gap-6">
          <a href="/map" className="px-4 py-2 text-xl font-bold text-orange leading-8">Map</a>
          <a href="/submit" className="px-4 py-2 text-xl font-bold text-white leading-8">Submit</a>
          <a href="https://github.com/" className="px-4 py-2 text-xl font-bold text-white leading-8">Github</a>
        </nav>
      </div>

      {/* Bottom decorative block row */}
      <div className="flex w-full justify-center items-center gap-5 overflow-hidden">
        {/* Three repeating coral‚Äëlike blocks (simplified) */}
        {[0,1,2].map(i => (
          <div key={i} className="relative h-60 w-[533px]">
            {/* top row */}
            <div className="absolute left-0 top-0 h-28 w-24 bg-vulcan-700" />
            <div className="absolute left-[103.71px] top-0 h-28 w-24 bg-vulcan-700" />
            <div className="absolute left-[203.73px] top-0 h-32 w-32 bg-vulcan-700" />
            <div className="absolute left-[303.75px] top-0 h-28 w-20 bg-vulcan-700" />
            <div className="absolute left-[399.72px] top-0 h-9 w-9 bg-vulcan-700" />
            {/* bottom row */}
            <div className="absolute left-0 top-[123.99px] h-28 w-24 bg-vulcan-700" />
            <div className="absolute left-[103.71px] top-[123.99px] h-28 w-24 bg-vulcan-700" />
            <div className="absolute left-[195.89px] top-[122.01px] h-32 w-32 bg-vulcan-700" />
            <div className="absolute left-[327.82px] top-[123.99px] h-28 w-24 bg-vulcan-700" />
            <div className="absolute left-[427.83px] top-[123.99px] h-28 w-28 bg-vulcan-700" />
          </div>
        ))}
      </div>
    </footer>
  );
}
```tsx
export default function Footer() {
  return (
    <footer className="bg-vulcan-900 text-white/80">
      <div className="mx-auto max-w-7xl px-4 py-10 grid gap-6 md:grid-cols-3">
        <div className="flex items-start gap-3">
          <div className="h-10 w-10 rounded-2xl bg-flamingo-400" aria-hidden />
          <p className="text-smb">
            Reef.Regen is a collaboration between <strong>Pollen Labs</strong> and <strong>MesoReef DAO</strong>.
            Built for transparent, verifiable ocean restoration.
          </p>
        </div>
        <nav className="md:col-start-3 flex items-center justify-end gap-6">
          <a href="/map" className="font-semibold text-flamingo-400">Map</a>
          <a href="/submit" className="font-semibold">Submit</a>
          <a href="https://github.com/" className="font-semibold">Github</a>
        </nav>
      </div>
    </footer>
  );
}
````

---

## `app/map/page.tsx`

````tsx
import AppShell from "@/components/AppShell";
import MapView from "@/components/map/MapView";
import LocationPane from "@/components/map/LocationPane";
import AttestationDetailModal from "@/components/shared/AttestationDetailModal"; // moved to shared
import { useState } from "react";
import type { Attestation, Location, LocationPoint } from "@/types/map";

export default function MapPage() {
  // mock state ‚Äî replace with data hooks
  const [activeLoc, setActiveLoc] = useState<Location | null>(null);
  const [activeAtt, setActiveAtt] = useState<Attestation | null>(null);

  const points: LocationPoint[] = [
    { id: "loc1", name: "Bali Reef", lat: -8.4095, lng: 115.1889, attestationCount: 4 },
  ];

  return (
    <AppShell>
      <div className="absolute inset-0">
        <MapView
          points={points}
          activeId={activeLoc?.id}
          onSelect={(id) => {
            // TODO: fetch location by id
            setActiveLoc({
              id,
              name: "Bali Reef",
              lat: -8.4095,
              lng: 115.1889,
              attestationCount: 4,
              actionsBreakdown: [
                { label: "Microfragmentation", count: 8, color: "#F034ED" },
                { label: "Nursery", count: 4, color: "#4DCEAE" },
              ],
              species: ["Heterogorgia tortuosa", "Acanella arbuscula"],
              attestations: [
                { id: "a1", title: "Coral Guardians Initiative", submittedAt: new Date().toISOString() },
                { id: "a2", title: "Regen Action B", submittedAt: new Date().toISOString() },
                { id: "a3", title: "Regen Action C", submittedAt: new Date().toISOString() },
              ],
            });
          }}
          onDeselect={() => setActiveLoc(null)}
        />

        <LocationPane
          location={activeLoc}
          onClose={() => setActiveLoc(null)}
          onOpenAttestation={(att) => setActiveAtt(att)}
        />

        <AttestationDetailModal attestation={activeAtt} onClose={() => setActiveAtt(null)} />
      </div>
    </AppShell>
  );
}
```tsx
import AppShell from "@/components/AppShell";
import MapView from "@/components/map/MapView";
import LocationPane from "@/components/map/LocationPane";
import AttestationDetailModal from "@/components/map/AttestationDetailModal";
import { useState } from "react";
import type { Attestation, Location, LocationPoint } from "@/types/map";

export default function MapPage() {
  // mock state ‚Äî replace with data hooks
  const [activeLoc, setActiveLoc] = useState<Location | null>(null);
  const [activeAtt, setActiveAtt] = useState<Attestation | null>(null);

  const points: LocationPoint[] = [
    { id: "loc1", name: "Bali Reef", lat: -8.4095, lng: 115.1889, attestationCount: 4 },
  ];

  return (
    <AppShell>
      <div className="absolute inset-0">
        <MapView
          points={points}
          activeId={activeLoc?.id}
          onSelect={(id) => {
            // TODO: fetch location by id
            setActiveLoc({
              id,
              name: "Bali Reef",
              lat: -8.4095,
              lng: 115.1889,
              attestationCount: 4,
              actionsBreakdown: [
                { label: "Microfragmentation", count: 8, color: "#F034ED" },
                { label: "Nursery", count: 4, color: "#4DCEAE" },
              ],
              species: ["Heterogorgia tortuosa", "Acanella arbuscula"],
              attestations: [
                { id: "a1", title: "Regen action", submittedAt: new Date().toISOString() },
              ],
            });
          }}
          onDeselect={() => setActiveLoc(null)}
        />

        <LocationPane
          location={activeLoc}
          onClose={() => setActiveLoc(null)}
          onOpenAttestation={(att) => setActiveAtt(att)}
        />

        <AttestationDetailModal attestation={activeAtt} onClose={() => setActiveAtt(null)} />
      </div>
    </AppShell>
  );
}
````

---

## `components/map/MapView.tsx`

```tsx
"use client";
import type { LocationPoint } from "@/types/map";

export default function MapView({
  points,
  activeId,
  onSelect,
  onDeselect,
}: {
  points: LocationPoint[];
  activeId?: string;
  onSelect: (id: string) => void;
  onDeselect: () => void;
}) {
  return (
    <div className="absolute inset-0 bg-vulcan-900/95">
      {/* TODO: integrate your map lib. The layer below is a placeholder */}
      <div className="absolute inset-0 select-none">
        {/* Mock pins */}
        <button
          onClick={() => onSelect(points[0].id)}
          className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-flamingo-400 ring-4 ring-flamingo-400/20"
          aria-label={`Open ${points[0].name}`}
        />
      </div>

      {/* Click-catcher to deselect */}
      {activeId && (
        <button className="absolute inset-0" aria-label="Close selection" onClick={onDeselect} />
      )}
    </div>
  );
}
```

---

## `components/map/LocationPane.tsx`

````tsx
"use client";
import type { Attestation, Location } from "@/types/map";

export default function LocationPane({ location, onClose, onOpenAttestation }: {
  location: Location | null;
  onClose: () => void;
  onOpenAttestation: (att: Attestation) => void;
}) {
  if (!location) return null;

  const totalActions = location.actionsBreakdown.reduce((s, a) => s + a.count, 0);

  return (
    <aside
      className="absolute left-0 top-0 z-10 h-full w-96 md:w-[420px] px-4 py-3.5 bg-vulcan-800/70 backdrop-blur-[3px] text-white overflow-y-auto"
      role="complementary"
      aria-label={`Location details for ${location.name}`}
    >
      <div className="flex flex-col gap-2">
        {/* Header Card */}
        <section className="p-6 bg-vulcan-900 rounded-3xl flex flex-col gap-3">
          <div>
            <div className="text-lgb text-vulcan-400 font-light">This location is claimed by</div>
            <h2 className="hd-4 text-white">{location.name}</h2>
          </div>
          <div>
            <div className="text-lgb text-vulcan-400 font-light">Coordinate</div>
            <div className="text-xlb font-bold">{location.lat.toFixed(5)}, {location.lng.toFixed(5)}</div>
          </div>
        </section>

        {/* Regen actions Card */}
        <section className="p-6 bg-vulcan-900 rounded-3xl flex flex-col gap-4">
          <div className="flex items-start justify-between gap-4">
            <div className="w-40">
              <div className="text-[52px] leading-[52px] font-black">{totalActions}</div>
              <div className="text-lgb text-vulcan-400 font-bold">Regen actions</div>
            </div>
            {/* Donut placeholders (2) matching figma circles */}
            <div className="h-24 w-24 rounded-full bg-magenta-300/90" />
            <div className="h-24 w-24 rounded-full bg-aquamarine-200/90" />
          </div>

          <div className="flex flex-col gap-1">
            {location.actionsBreakdown.map((a) => (
              <div key={a.label} className="flex items-center justify-between">
                <div className="flex items-center gap-2 min-w-0">
                  <span className="h-5 w-2.5 rounded" style={{ backgroundColor: a.color }} />
                  <span className="text-lgb font-light truncate">{a.label}</span>
                </div>
                <span className="text-lgb font-bold">{a.count}</span>
              </div>
            ))}
          </div>
        </section>

        {/* Species diversity Card */}
        <section className="p-6 bg-vulcan-900 rounded-3xl flex flex-col gap-4">
          <div>
            <div className="text-[52px] leading-[52px] font-black">{location.species.length}</div>
            <div className="text-lgb text-vulcan-400 font-bold">Species diversity</div>
          </div>
          <div className="flex flex-wrap gap-2">
            {location.species.map((s) => (
              <span key={s} className="h-8 px-3 py-1 rounded-lg bg-ribbon-300 inline-flex items-center">
                <span className="text-lgb font-bold text-vulcan-900">{s}</span>
              </span>
            ))}
          </div>
        </section>

        {/* Attestations header */}
        <section className="p-6 bg-vulcan-900 rounded-t-3xl flex flex-col gap-4">
          <div>
            <div className="text-[52px] leading-[52px] font-black">{location.attestations.length}</div>
            <div className="text-lgb text-vulcan-400 font-bold">Attestations</div>
          </div>
        </section>

        {/* Attestation rows */}
        <ul className="overflow-hidden rounded-b-3xl">
          {location.attestations.map((a, idx) => {
            const isActive = false; // hook to selection state if needed
            const base = idx === location.attestations.length - 1
              ? "rounded-b-3xl"
              : "";
            return (
              <li key={a.id}>
                <button
                  onClick={() =>
                    onOpenAttestation({
                      id: a.id,
                      title: a.title,
                      submittedAt: a.submittedAt,
                      actionTypes: ["Microfragmentation", "Nursery"],
                      species: location.species,
                      locationId: location.id,
                    })
                  }
                  className={`w-full px-5 py-4 flex items-center justify-between text-left ${isActive ? "bg-vulcan-500" : "bg-vulcan-900"} ${base} hover:bg-vulcan-700/80`}
                >
                  <span className="text-lgb font-light text-vulcan-300">
                    {new Date(a.submittedAt).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}
                  </span>
                  <span className="h-5 w-5 relative">
                    <span className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 block h-[3.35px] w-4 bg-flamingo-200" />
                  </span>
                </button>
              </li>
            );
          })}
        </ul>
      </div>

      {/* Decorative vertical bar at far right of pane */}
      <div className="absolute right-0 top-1 w-2 h-64 bg-vulcan-900 rounded-lg" aria-hidden />

      {/* Close hint for keyboard users */}
      <span className="sr-only">Press Escape or click outside the pane to close</span>
    </aside>
  );
}
```tsx
"use client";
import type { Attestation, Location } from "@/types/map";

export default function LocationPane({ location, onClose, onOpenAttestation }: {
  location: Location | null;
  onClose: () => void;
  onOpenAttestation: (att: Attestation) => void;
}) {
  if (!location) return null;
  return (
    <aside className="absolute left-0 top-0 z-10 h-full w-[340px] md:w-[420px] bg-vulcan-800/95 backdrop-blur border-r border-white/10 p-4 overflow-y-auto text-white">
      <header className="mb-4">
        <p className="text-smb text-white/60">This location is claimed by</p>
        <h2 className="hd-4 text-white">{location.name}</h2>
        <p className="text-smb text-white/60">{location.lat.toFixed(5)}, {location.lng.toFixed(5)}</p>
      </header>

      <section className="rounded-3xl bg-vulcan-900/80 p-4 mb-4">
        <div className="flex items-center justify-between">
          <div>
            <div className="hd-5 text-white">12</div>
            <div className="text-lgb text-white/80">Regen actions</div>
          </div>
          <div className="h-16 w-16 rounded-full bg-white/10" />
        </div>
        <ul className="mt-4 space-y-2 text-smb">
          {location.actionsBreakdown.map(a => (
            <li key={a.label} className="flex items-center justify-between">
              <span className="inline-flex items-center gap-2">
                <span className="h-3 w-3 rounded bg-[var(--c)]" style={{ ['--c' as any]: a.color }} />
                {a.label}
              </span>
              <span>{a.count}</span>
            </li>
          ))}
        </ul>
      </section>

      <section className="rounded-3xl bg-vulcan-900/80 p-4 mb-4">
        <div className="hd-6 text-white">Species diversity</div>
        <div className="mt-3 flex flex-wrap gap-2">
          {location.species.map(s => (
            <span key={s} className="rounded-xl bg-ribbon-300/40 px-3 py-1 text-smb text-white shadow-inner">{s}</span>
          ))}
        </div>
      </section>

      <section className="rounded-3xl bg-vulcan-900/80 p-1 mb-4">
        <div className="px-3 py-2 text-white/80">Attestations</div>
        <ul>
          {location.attestations.map(a => (
            <li key={a.id}>
              <button
                onClick={() => onOpenAttestation({
                  id: a.id,
                  title: a.title,
                  submittedAt: a.submittedAt,
                  actionTypes: ["Microfragmentation", "Nursery"],
                  species: location.species,
                  locationId: location.id,
                })}
                className="group flex w-full items-center justify-between rounded-2xl px-4 py-4 text-left hover:bg-vulcan-700/70"
              >
                <span className="font-medium text-white">{new Date(a.submittedAt).toLocaleDateString()}</span>
                <span className="opacity-60 group-hover:opacity-100">¬∑¬∑¬∑</span>
              </button>
            </li>
          ))}
        </ul>
      </section>

      <button onClick={onClose} className="mt-2 w-full rounded-2xl border border-white/15 px-4 py-2 text-white/80 hover:bg-white/5">Close</button>
    </aside>
  );
}
````

---

## `components/shared/AttestationDetailModal.tsx`

````tsx
"use client";
import type { Attestation } from "@/types/map";

/**
 * Global, reusable modal for viewing an Attestation.
 * Matches Figma: 716px, rounded-3xl, 1px outline (Vulcan-500), subtle backdrop blur.
 */
export default function AttestationDetailModal({ attestation, onClose }: {
  attestation: Attestation | null;
  onClose: () => void;
}) {
  if (!attestation) return null;
  const submitted = new Date(attestation.submittedAt).toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" });
  const actionDate = attestation.actionDate
    ? new Date(attestation.actionDate).toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" })
    : undefined;

  return (
    <div className="fixed inset-0 z-20 flex items-center justify-center bg-black/40 p-4 backdrop-blur-[3px]" role="dialog" aria-modal="true">
      <div className="relative w-full max-w-[716px] rounded-3xl bg-vulcan-900 outline outline-1 outline-vulcan-500 outline-offset-[-1px] text-white shadow-2xl p-6">
        {/* Close */}
        <div className="flex w-full justify-end pb-3">
          <button aria-label="Close" onClick={onClose} className="p-2 bg-white text-black rounded-[43px] hover:bg-white/90">
            {/* icon placeholder */}
            <span className="block h-3.5 w-3.5 bg-black" />
          </button>
        </div>

        {/* Submitted + Org */}
        <div className="space-y-6">
          <div>
            <div className="text-lgb text-vulcan-100 font-light">
              Submitted on <span className="font-bold">{submitted}</span> by
            </div>
            <div className="mt-1 text-[28px] leading-7 tracking-tight font-black">{attestation.title ?? "Coral Guardians Initiative"}</div>
          </div>

          {/* Actions included */}
          <div className="flex flex-wrap gap-8">
            <div className="flex-1 min-w-[260px] space-y-2">
              <div className="text-lgb text-vulcan-400 font-light">Regen actions include:</div>
              <div className="flex flex-wrap gap-1">
                {attestation.actionTypes.map(t => (
                  <span key={t} className="h-8 px-3 py-1 rounded-lg inline-flex items-center bg-magenta-300 text-vulcan-900 text-lgb font-bold first:bg-aquamarine-300">
                    {t}
                  </span>
                ))}
              </div>
            </div>
          </div>

          {/* Dates */}
          <div>
            <div className="text-lgb text-vulcan-400 font-light">Action taking place on:</div>
            {actionDate && <div className="text-lgb text-vulcan-100 font-bold">{actionDate}</div>}
          </div>

          {/* Summary */}
          {attestation.summary && (
            <div>
              <div className="text-lgb text-vulcan-400 font-light">Action summary:</div>
              <div className="text-lgb text-vulcan-100 font-bold">{attestation.summary}</div>
            </div>
          )}

          {/* Stats grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-8">
            {attestation.coralCount != null && (
              <div>
                <div className="text-lgb text-vulcan-400 font-light">Coral counts at the time:</div>
                <div className="text-lgb text-white font-bold">{attestation.coralCount}</div>
              </div>
            )}
            {attestation.depth && (
              <div>
                <div className="text-lgb text-vulcan-400 font-light">Depth:</div>
                <div className="text-lgb text-white font-bold">{attestation.depth}</div>
              </div>
            )}
          </div>

          {/* Species */}
          {attestation.species?.length ? (
            <div className="space-y-2">
              <div className="text-lgb text-vulcan-400 font-light">Species include:</div>
              <div className="flex flex-wrap gap-1">
                {attestation.species.map(s => (
                  <span key={s} className="h-8 px-3 py-1 rounded-lg bg-ribbon-300 inline-flex items-center">
                    <span className="text-lgb font-bold text-vulcan-900">{s}</span>
                  </span>
                ))}
              </div>
            </div>
          ) : null}

          {/* Contributors */}
          {attestation.contributors?.length ? (
            <div>
              <div className="text-lgb text-vulcan-400 font-light">With the following contributors:</div>
              <div className="text-lgb text-white font-bold">{attestation.contributors.join(", ")}</div>
            </div>
          ) : null}

          {/* Media */}
          {(attestation.fileName || attestation.fileUrl) && (
            <div className="p-4 bg-vulcan-800 rounded-3xl">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-base text-vulcan-400 font-light">Additional media</div>
                  <div className="text-base text-white font-light">{attestation.fileName ?? attestation.fileUrl}</div>
                </div>
                {attestation.fileUrl && (
                  <a className="text-base font-bold text-flamingo-200" href={attestation.fileUrl} target="_blank">View</a>
                )}
              </div>
            </div>
          )}

          {/* EAS UID */}
          {attestation.easUid && (
            <div className="p-4 bg-vulcan-800 rounded-3xl">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-base text-vulcan-400 font-light">Attestation UID</div>
                  <div className="text-base text-white font-light">{attestation.easUid}</div>
                </div>
                <a className="text-base font-bold text-flamingo-200" href={`https://easscan.org/attestation/view/${attestation.easUid}`} target="_blank">View on Ethereum Attestation Service</a>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```tsx
"use client";
import type { Attestation } from "@/types/map";

export default function AttestationDetailModal({ attestation, onClose }: {
  attestation: Attestation | null;
  onClose: () => void;
}) {
  if (!attestation) return null;
  return (
    <div className="fixed inset-0 z-20 flex items-center justify-center bg-black/40 p-4" role="dialog" aria-modal="true">
      <div className="relative w-full max-w-2xl rounded-3xl bg-vulcan-900 text-white shadow-2xl">
        <button aria-label="Close" onClick={onClose} className="absolute right-3 top-3 rounded-xl px-3 py-2 hover:bg-white/10">‚úï</button>
        <div className="p-6 space-y-4">
          <header>
            <p className="text-smb text-white/70">Submitted on {new Date(attestation.submittedAt).toLocaleDateString()}</p>
            <h3 className="hd-5 text-white">{attestation.title ?? "Coral Guardians Initiative"}</h3>
          </header>
          <div className="flex flex-wrap gap-2">
            {attestation.actionTypes.map(t => (
              <span key={t} className="rounded-xl bg-flamingo-400/80 px-3 py-1 text-smb text-white">{t}</span>
            ))}
          </div>
          {attestation.summary && <p className="text-baseb text-white/80">{attestation.summary}</p>}

          <div className="grid grid-cols-2 gap-4 text-baseb">
            {attestation.coralCount != null && (
              <div>
                <div className="text-white/60">Coral counts at the time</div>
                <div className="font-semibold">{attestation.coralCount}</div>
              </div>
            )}
            {attestation.depth && (
              <div>
                <div className="text-white/60">Depth</div>
                <div className="font-semibold">{attestation.depth}</div>
              </div>
            )}
          </div>

          {attestation.species?.length ? (
            <div>
              <div className="text-white/70 mb-2">Species include:</div>
              <div className="flex flex-wrap gap-2">
                {attestation.species.map(s => (
                  <span key={s} className="rounded-xl bg-ribbon-300/40 px-3 py-1 text-smb">{s}</span>
                ))}
              </div>
            </div>
          ) : null}

          {attestation.contributors?.length ? (
            <div className="text-baseb text-white/80">
              With the following contributors: <strong>{attestation.contributors.join(", ")}</strong>
            </div>
          ) : null}

          {(attestation.fileName || attestation.fileUrl) && (
            <div className="rounded-2xl bg-vulcan-800/80 p-4">
              <div className="text-white/70 text-smb">Additional media</div>
              <div className="flex items-center justify-between">
                <div>{attestation.fileName ?? attestation.fileUrl}</div>
                {attestation.fileUrl && (
                  <a className="text-flamingo-400 font-semibold" href={attestation.fileUrl} target="_blank">View</a>
                )}
              </div>
            </div>
          )}

          {attestation.easUid && (
            <div className="rounded-2xl bg-vulcan-800/80 p-4">
              <div className="text-white/70 text-smb">Attestation UID</div>
              <div className="flex items-center justify-between">
                <code className="truncate">{attestation.easUid}</code>
                <a className="text-flamingo-400 font-semibold" href={`https://easscan.org/attestation/view/${attestation.easUid}`} target="_blank">View on EAS</a>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
````

---

> All skeletons use the **0.6 typography classes** (`hd-*`, `text-*-b`), dark vulcan surfaces, and flamingo/ribbon accents to match your Figma. Hook your map library and real data when ready.

---

## TL;DR - Implementation Progress

**Completed: Phase 1 (Global Navigation) & Phase 2 (Map Foundation)**

### ‚úÖ Phase 1: Global Navigation (Complete)
- **TopNav** ([components/TopNav.tsx](../components/TopNav.tsx))
  - Sticky black header with `full-logo.svg`
  - Links: Map, Submit (goes to `/attest`)
  - Sign in button opens Web3Auth modal, shows wallet address when connected
  - Active states: orange color on current page
  - Mobile: hamburger menu with slide-in sheet
  - Logo links to home page
- **Footer** ([components/Footer.tsx](../components/Footer.tsx))
  - Vulcan-800 background with `logo.svg` and decorative coral pattern (`img-logo-repeat-footer.svg`)
  - Links: Map, Submit, Github (https://github.com/Pollen-labs/reef.regen)
  - Clickable organization names: Pollen Labs, MesoReef DAO
  - Active states: orange color on current page
  - Hidden on `/map` page for full-height experience
- **AppShell** ([components/AppShell.tsx](../components/AppShell.tsx))
  - Global layout wrapper with TopNav + content + conditional Footer
  - Detects `/map` route and hides footer

### ‚úÖ Phase 2: Map Page Foundation (Complete)
- **Type Contracts** ([types/map.ts](../types/map.ts))
  - `LocationPoint`, `Location`, `Attestation` types defined
  - Path alias `@/types/*` configured in tsconfig.json
- **MapView Component** ([components/map/MapView.tsx](../components/map/MapView.tsx))
  - Full-screen MapLibre GL canvas with dark theme (`/map/styles/dark_matter.json`)
  - Flamingo-400 (#FF7F5C) circular pins
  - Interactive: click pin ‚Üí `onSelect`, ESC ‚Üí deselect
  - Selected pins highlighted: larger size + white stroke
  - Props-driven architecture (no direct API calls)
- **Map Page** ([app/map/page.tsx](../app/map/page.tsx))
  - Full viewport height (`absolute inset-0`), no page title
  - Wired with mock data (3 locations: Bali, Great Barrier Reef, Caribbean)
  - State management for active location selection

**Test at:** http://localhost:3001/map

### üöß Phase 3: Interactive Components (Next)
- **3A:** LocationPane (left drawer with stats, species, attestations)
- **3B:** AttestationDetailModal (centered modal with full details)
- **3C:** Wire open/close flows + keyboard navigation


## update on oct 30
- location pane component is complete with interaction
- map view and dot interaction polished
- temporary pause work due to waiting for backend update
